<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka Progress in Summer 2015</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-progress-summer-2015.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.svg" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference external" href="https://nuitka.github.io/Nuitka-website">home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.20 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-19">Nuitka Release 0.6.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">Streaming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under construction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-progress-in-summer-2015">
<h1><a class="toc-backref" href="#id1">Nuitka Progress in Summer 2015</a><a class="headerlink" href="#nuitka-progress-in-summer-2015" title="Permalink to this headline"></a></h1>
<p>A long time has passed again without me speaking about what’s going on
with Nuitka, and that although definitely a lot has happened. I would
contend it’s even <em>because</em> so much is going on.</p>
<p>I also am shy to make public postings about unfinished stuff it seems,
but it’s long overdue, so much important and great stuff has happened.
We are in the middle of big things with the compiler and there is a lot
of great achievement.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#nuitka-progress-in-summer-2015" id="id1">Nuitka Progress in Summer 2015</a></p>
<ul>
<li><p><a class="reference internal" href="#ssa-single-state-assignment-form" id="id2">SSA (Single State Assignment Form)</a></p></li>
<li><p><a class="reference internal" href="#function-inlining" id="id3">Function Inlining</a></p></li>
<li><p><a class="reference internal" href="#scalability" id="id4">Scalability</a></p></li>
<li><p><a class="reference internal" href="#compatibility" id="id5">Compatibility</a></p>
<ul>
<li><p><a class="reference internal" href="#python-3-5" id="id6">Python 3.5</a></p></li>
<li><p><a class="reference internal" href="#importing-enhancements" id="id7">Importing Enhancements</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance" id="id8">Performance</a></p>
<ul>
<li><p><a class="reference internal" href="#graphs-and-benchmarks" id="id9">Graphs and Benchmarks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#standalone" id="id10">Standalone</a></p></li>
<li><p><a class="reference internal" href="#other-stuff" id="id11">Other Stuff</a></p>
<ul>
<li><p><a class="reference internal" href="#funding" id="id12">Funding</a></p></li>
<li><p><a class="reference internal" href="#europython-2015" id="id13">EuroPython 2015</a></p></li>
<li><p><a class="reference internal" href="#collaborators" id="id14">Collaborators</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#future" id="id15">Future</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="ssa-single-state-assignment-form">
<h2><a class="toc-backref" href="#id2">SSA (Single State Assignment Form)</a><a class="headerlink" href="#ssa-single-state-assignment-form" title="Permalink to this headline"></a></h2>
<p>For a long, long time already, each release of Nuitka has worked towards
increasing <a class="reference external" href="http://en.wikipedia.org/wiki/Static_single_assignment_form">“SSA”</a> usage in
Nuitka.</p>
<p>Now it’s there. The current pre-release just uses it. There were many
things to consider before enabling it, and always a next thing to be
found that was needed. Often good changes to Nuitka, it was also
annoying the hell out of me at times.</p>
<p>But basically now the forward propagation of variables is in place, with
some limitations that are going to fall later.</p>
<p>So the current release, soon to be replaced, still doesn’t optimize this
code as well as possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
<p>But starting with the next release, the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is forward
propagated (also in way more complex situations), and that’s a serious
milestone for the project.</p>
</section>
<section id="function-inlining">
<h2><a class="toc-backref" href="#id3">Function Inlining</a><a class="headerlink" href="#function-inlining" title="Permalink to this headline"></a></h2>
<p>When submitting my talk to EuroPython 2015, I was putting a lot of
pressure on me by promising to demo that. And I did. It was based on the
SSA code that only now became completely reliable, but otherwise very
few few other changes, and it just worked.</p>
<p>The example I used is this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># can be inlined</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
<p>So, the function <code class="docutils literal notranslate"><span class="pre">g</span></code> is forward propagated to a direct call, as are
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> into the <code class="docutils literal notranslate"><span class="pre">return</span></code> statement after making the in-line,
making this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Currently function in-lining is not yet activated by default, for this I
am waiting for a release cycle to carry the load of SSA in the wild. As
you probably know I usually tend to be conservative and to not make too
many changes at once.</p>
<p>And as this works for local functions only yet, it’s not too important
yet either. This will generally become relevant once we have this
working across modules and their globally defined functions or methods.
This will be a while until Nuitka gets there.</p>
</section>
<section id="scalability">
<h2><a class="toc-backref" href="#id4">Scalability</a><a class="headerlink" href="#scalability" title="Permalink to this headline"></a></h2>
<p>Having got Nuitka’s memory usage under control, it turned out that there
are files that can trigger Python recursion <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> exception
when using the <code class="docutils literal notranslate"><span class="pre">ast</span></code> module to build the Nuitka internal tree. People
really have code with many thousands of operations to a <code class="docutils literal notranslate"><span class="pre">+</span></code> operation.</p>
<p>So, Nuitka here learned to include whole modules as bytecode when it is
too complex as there is no easy way to expand the stack on Windows at
least. That is kind of a limitation of CPython itself I didn’t run into
so far, and rather very annoying too.</p>
<p>The scalability of Nuitka also depends much on generated code size. With
the optimization become more clever, less code is generated, and that
trend will continue as more structural optimization are applied.</p>
</section>
<section id="compatibility">
<h2><a class="toc-backref" href="#id5">Compatibility</a><a class="headerlink" href="#compatibility" title="Permalink to this headline"></a></h2>
<p>Very few things are possible here anymore. For the tests, in full
compatibility mode, even more often the less good line number is used.</p>
<p>Also the plug-in work is leading to improved compatibility with Qt
plugins of PySide and PyQt. Or another example is the
<code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module that on Windows is now supposed to fork
compiled code too.</p>
<section id="python-3-5">
<h3><a class="toc-backref" href="#id6">Python 3.5</a><a class="headerlink" href="#python-3-5" title="Permalink to this headline"></a></h3>
<p>The next release has experimental support for Python 3.5, with the
notable exception that <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code>, these do not yet work.
It passes the existing test suite for CPython3.4 successfully. Passing
here means, to pass or fail in the same way as does the uncompiled
Python. Failures are of course expected, as details change, and a nice
way of having coverage for exception codes.</p>
<p>The new <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator is now supported. As the stable release of
Python3.5 was made recently, there is now some pressure on having full
support of course.</p>
<p>I am not sure, if you can fully appreciate the catch up game to play
here. It will take a compiled coroutine to support these things
properly. And that poses lots of puzzles to solve. As usual I am binding
these to internal cleanups so it becomes simpler.</p>
<p>In the case of Python3.5, the single function body node type that is
used for generators, class bodies, and function, is bound to be replaced
with a base class and detailing instances, instead of one thing for them
all, then with coroutines added.</p>
</section>
<section id="importing-enhancements">
<h3><a class="toc-backref" href="#id7">Importing Enhancements</a><a class="headerlink" href="#importing-enhancements" title="Permalink to this headline"></a></h3>
<p>A while ago, the import logic was basically re-written with
compatibility much increased. Then quite some issues were fixed. I am
not sure, but some of the fixes have apparently also been regressions at
times, with the need for other fixes now.</p>
<p>So it may have worked for you in the past, but you might have to report
new found issues.</p>
<p>It’s mainly the standalone community that encounters these issues, when
just one of these imports doesn’t find the correct thing, but picking
the wrong one will of course have seriously bad impacts on compile time
analysis too. So once we do cross module optimization, this must be rock
solid.</p>
<p>I think we have gotten a long way there, but we still need to tackle
some more fine details.</p>
</section>
</section>
<section id="performance">
<h2><a class="toc-backref" href="#id8">Performance</a><a class="headerlink" href="#performance" title="Permalink to this headline"></a></h2>
<section id="graphs-and-benchmarks">
<h3><a class="toc-backref" href="#id9">Graphs and Benchmarks</a><a class="headerlink" href="#graphs-and-benchmarks" title="Permalink to this headline"></a></h3>
<p>I also presented this weak point to EuroPython 2015 and my plan on how
to resolve it. And low and behold, turns out the PyPy people had already
developed a tool that will be usable for the task and to present to the
conference.</p>
<p>So basically I was capable of doing kind of a prototype of comparative
benchmark during EuroPython 2015 already. I will need to complete this.
My plan was to get code names of functions sorted out in a better way,
to more easily match the Nuitka C function names with Python functions
in an automatic way. That matching is the hard part.</p>
<p>So that is already progressing, but I could need help with that
definitely.</p>
<p>Nuitka really has to catch up with benchmarks generally.. The work on
automated performance graphs has made more progress, and they are
supposed to show up on <a class="reference external" href="https://speedcenter.nuitka.net">Nuitka Speedcenter</a> each time, <code class="docutils literal notranslate"><span class="pre">master</span></code>, <code class="docutils literal notranslate"><span class="pre">develop</span></code>,
or <code class="docutils literal notranslate"><span class="pre">factory</span></code> git branches change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There currently is no structure to these graphs. There is no
explanations or comments, and there is no trend indicators. All of
which makes it basically useless to everybody except me. And even
harder for me than necessary.</p>
</div>
<p>As a glimpse of what is possible with in-lined functions, look at this:</p>
<p><a class="reference external" href="https://speedcenter.nuitka.net/constructs/construct-calllambdaexpressiondirectly.html">Lambda call construct case</a></p>
<p>But we also need to put real programs and use cases to test. This may
need your help. Let me know if you want to. It takes work on taking the
data, and merging them into one view, linking it with the source code
ideally. That will be the tool you can just use on your own code.</p>
</section>
</section>
<section id="standalone">
<h2><a class="toc-backref" href="#id10">Standalone</a><a class="headerlink" href="#standalone" title="Permalink to this headline"></a></h2>
<p>The standalone mode of Nuitka was pretty good, and continued to improve
further, now largely with the help of plug-ins.</p>
<p>I now know that PyGTK is an issue and will need a plug-in to work. Once
the plug-in interface is public, I hope for more outside contributions
here.</p>
</section>
<section id="other-stuff">
<h2><a class="toc-backref" href="#id11">Other Stuff</a><a class="headerlink" href="#other-stuff" title="Permalink to this headline"></a></h2>
<section id="funding">
<h3><a class="toc-backref" href="#id12">Funding</a><a class="headerlink" href="#funding" title="Permalink to this headline"></a></h3>
<p>Nuitka receives the occasional <a class="reference external" href="/pages/donations.html">donation</a> and those make me very happy.
As there is no support from organization like the PSF, I am all on my
own there.</p>
<p>This year I traveled to Europython 2015, I needed a new desktop computer
after burning the old one through with CI tests, the website has running
costs, and so on. That is pretty hefty money. It would be sweet if aside
of my free time it wouldn’t also cost me money.</p>
</section>
<section id="europython-2015">
<h3><a class="toc-backref" href="#id13">EuroPython 2015</a><a class="headerlink" href="#europython-2015" title="Permalink to this headline"></a></h3>
<p>This was a blast. Meeting people who knew Nuitka but not me was a
regular occurrence. And many people well appreciate my work. It felt
much different than the years before.</p>
<p>I was able to present Nuitka’s function in-lining indeed there, and this
high goal that I set myself, quite impressed people. My talk went very
well, I am going to post a link separately in another post.</p>
<p>Also I made many new contacts, largely with the scientific community. I
hope to find work with data scientists in the coming years. More amd
more it looks like my day job should be closer to Nuitka and my
expertise in Python.</p>
</section>
<section id="collaborators">
<h3><a class="toc-backref" href="#id14">Collaborators</a><a class="headerlink" href="#collaborators" title="Permalink to this headline"></a></h3>
<p>Nuitka is making break through progress. And you can be a part of it.
Now.</p>
<p>You can join and should do so now, just <a class="reference external" href="/doc/user-manual.html#join-nuitka">follow this link</a> or become part of
the mailing list (since closed) and help me there with request I make,
e.g. review posts of mine, test out things, pick up small jobs, answer
questions of newcomers, you know the drill probably.</p>
</section>
</section>
<section id="future">
<h2><a class="toc-backref" href="#id15">Future</a><a class="headerlink" href="#future" title="Permalink to this headline"></a></h2>
<p>So, there is multiple things going on:</p>
<ul>
<li><p>Function in-lining</p>
<p>For locally declared functions, it should become possible to avoid
their creation, and make direct calls instead of ones that use
function objects and expensive parameter handling.</p>
</li>
<li><p>Nested frames</p>
<p>One result of in-lining will be nested frames still present for
exceptions to be properly annotated, or <code class="docutils literal notranslate"><span class="pre">locals</span></code> giving different
sets of locals and so on.</p>
<p>Some cleanup of these will be needed for code generation and SSA to
be able to attach variables to some sort of container, and for a
function to be able to reference different sets of these.</p>
</li>
<li><p>Type Inference</p>
<p>With SSA in place, we really can start to recognize types, and treat
things that work something assigned from <code class="docutils literal notranslate"><span class="pre">[]</span></code> different, and with
code special to these.</p>
<p>That’s going to be a lot of work. For <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code> there
are very important use cases, where the code can be much better.</p>
</li>
<li><p>Shape Analyisis</p>
<p>My plan for types, is not to use them, but the more general shapes,
things that will be more prevalent than actual type information in a
program. In fact the precise knowledge will be rare, but more often,
we will just have a set of operations performed on a variable, and be
able to guess from there.</p>
</li>
<li><p>Python 3.5 new features</p>
<p>The coroutines are a new type, and currently it’s unclear how deep
this is tied into the core of things, i.e. if a compile coroutine can
be a premier citizen immediately, or if that needs more work. I hope
it just takes for the code object to have the proper flag. But there
could be stupid type checks, we shall see.</p>
</li>
<li><p>Plug-ins</p>
<p>Something I wish I could have shown at EuroPython was plug-ins to
Nuitka. It is recently becoming more complete, and some demo plug-ins
for say Qt plugins, or multiprocessing, are starting to work. The API
will need work and of course documentation. Hope is for this to
expand Nuitka’s reach and appeal to get more contributors.</p>
</li>
</ul>
<p>Let me know, if you are willing to help. I really need that help to make
things happen faster. Nuitka will become more and more important only.</p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="nuitka-release-0514.html">
       Nuitka Release 0.5.14
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="nuitka-release-0515.html">
      Nuitka Release 0.5.15 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-progress-summer-2015.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-progress-summer-2015.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-progress-summer-2015.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>